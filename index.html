<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<title>Stamina Counters (Stateful + Economy)</title>
<meta name="viewport" content="width=device-width, initial-scale=1" />

<style>
  :root{ --w:320px; --h:14px; }
  body { font-family: system-ui, sans-serif; padding:20px; }
  .row { display:flex; align-items:center; gap:10px; flex-wrap:wrap; }
  .stack { display:grid; gap:6px; margin-bottom:20px; }
  .bar-container { width:var(--w); height:var(--h); border:1px solid #000; background:#eee; }
  .bar { height:100%; background:linear-gradient(90deg,#2ecc71,#27ae60); }
  button { padding:6px 10px; }
  button:disabled { opacity:.5; }
  .tag { font-size:12px; opacity:.7; }
  .panel { padding:8px 10px; border:1px dashed #aaa; background:#fafafa; }
  .muted { color:#b00; font-weight:600; }
</style>

<script>
/* ============================================================
   CONFIG â€” edit everything here
   ============================================================ */
const CONFIG = {
  STATE: {
    START: 'menu'
  },
  USER: {
    MAX_STAMINA: 100,
    BASE_TICK_SPEED: 3,
    DISPLAY_DECIMALS: 0
  },
  NPC: {
    COUNT: 5,
    STAMINA_STEPS: [500,1000,10000],
    BASE_TICK_SPEED: 3,
    DISPLAY_DECIMALS: 0
  },
  ECONOMY: {
    STARTING_COINS: 0
  },
  ITEMS: {
    WATER:      { price: 1 },
    BEER:       { price: 1 },
    ICE_CREAM:  { price: 1 },
    HAT:        { price: 1 }
  },
  EFFECTS: {
    BEER: { SPEED_DELTA:-1, DURATION_S:10 },
    ICE_CREAM: { STAMINA:80 },
    HAT: { REDUCTION_FACTOR:0.2, DURATION_S:15 }
  }
};
/* ===================== end CONFIG ===================== */

/* ------------------------------------------------------------
   Game State
   ------------------------------------------------------------ */
const GameState = {
  current: CONFIG.STATE.START,
  set(state){
    this.current = state;
    syncUIState();
  },
  is(state){ return this.current === state; }
};

/* ------------------------------------------------------------
   Economy & Inventory
   ------------------------------------------------------------ */
let coins = CONFIG.ECONOMY.STARTING_COINS;
const inventory = {
  WATER:0,
  BEER:0,
  ICE_CREAM:0,
  HAT:0
};

function canAfford(item){
  return coins >= CONFIG.ITEMS[item].price;
}
function buyItem(item){
  if (!GameState.is('menu')) return;
  if (!canAfford(item)) return;
  coins -= CONFIG.ITEMS[item].price;
  inventory[item]++;
  updateEconomyUI();
}
function consumeItem(item){
  if (inventory[item] <= 0) return false;
  inventory[item]--;
  updateEconomyUI();
  return true;
}

/* ------------------------------------------------------------
   Core Actors
   ------------------------------------------------------------ */
class Actor {
  constructor(max, speed, decimals){
    this.max = max;
    this.value = max;
    this.speed = speed;
    this.decimals = decimals;
  }
  tick(dt){ this.value = Math.max(0, this.value - this.speed * dt); }
  add(v){ this.value = Math.min(this.max, this.value + v); }
  percent(){ return (this.value / this.max) * 100; }
  text(){ return this.value.toFixed(this.decimals); }
  isZero(){ return this.value <= 0; }
}

let USER, NPCS = [];
let lastTs = performance.now();
let running = false;

/* ------------------------------------------------------------
   Init / Reset
   ------------------------------------------------------------ */
function initRun(){
  USER = new Actor(CONFIG.USER.MAX_STAMINA, CONFIG.USER.BASE_TICK_SPEED, CONFIG.USER.DISPLAY_DECIMALS);
  NPCS = Array.from({length:CONFIG.NPC.COUNT}, ()=>{
    const max = CONFIG.NPC.STAMINA_STEPS[Math.floor(Math.random()*CONFIG.NPC.STAMINA_STEPS.length)];
    return new Actor(max, CONFIG.NPC.BASE_TICK_SPEED, CONFIG.NPC.DISPLAY_DECIMALS);
  });
  lastTs = performance.now();
}

/* ------------------------------------------------------------
   Main Loop
   ------------------------------------------------------------ */
function loop(ts){
  const dt = (ts - lastTs)/1000;
  lastTs = ts;

  if (running && GameState.is('playing')) {
    USER.tick(dt);
    NPCS.forEach(n=>n.tick(dt));
    if (USER.isZero()) endRun();
    updateUI();
  }
  requestAnimationFrame(loop);
}

/* ------------------------------------------------------------
   State Transitions
   ------------------------------------------------------------ */
function startRun(){
  initRun();
  running = true;
  GameState.set('playing');
}
function endRun(){
  running = false;
  GameState.set('menu');
}

/* ------------------------------------------------------------
   Actions (consume inventory)
   ------------------------------------------------------------ */
function useWater(){
  if (!consumeItem('WATER')) return;
  USER.add(-10);
}
function useBeer(){
  if (!consumeItem('BEER')) return;
}
function useIceCream(){
  if (!consumeItem('ICE_CREAM')) return;
  USER.add(CONFIG.EFFECTS.ICE_CREAM.STAMINA);
}

/* ------------------------------------------------------------
   UI Sync
   ------------------------------------------------------------ */
function syncUIState(){
  const inMenu = GameState.is('menu');
  document.querySelectorAll('.action').forEach(b=>b.disabled=inMenu);
  document.getElementById('go-btn').disabled=!inMenu;
}

function updateEconomyUI(){
  document.getElementById('coins').textContent = coins;
  for (const k in inventory){
    document.getElementById(`inv-${k}`).textContent = inventory[k];
  }
}

function updateUI(){
  document.getElementById('user-val').textContent = USER.text();
  document.getElementById('user-bar').style.width = USER.percent()+'%';
}

/* ------------------------------------------------------------
   Bootstrap
   ------------------------------------------------------------ */
document.addEventListener('DOMContentLoaded',()=>{
  syncUIState();
  updateEconomyUI();
  requestAnimationFrame(loop);
});
</script>
</head>

<body>

<h2>Menu</h2>
<div class="panel">
  Coins: <strong id="coins">0</strong>
  <div class="row">
    <button onclick="buyItem('WATER')">Buy Water</button>
    <button onclick="buyItem('BEER')">Buy Beer</button>
    <button onclick="buyItem('ICE_CREAM')">Buy Ice Cream</button>
    <button onclick="buyItem('HAT')">Buy Hat</button>
  </div>
  <div class="row tag">
    Water: <span id="inv-WATER">0</span> |
    Beer: <span id="inv-BEER">0</span> |
    Ice Cream: <span id="inv-ICE_CREAM">0</span> |
    Hat: <span id="inv-HAT">0</span>
  </div>
  <button id="go-btn" onclick="startRun()">Go In</button>
</div>

<hr/>

<h2>User</h2>
<div class="stack">
  <div>Stamina: <span id="user-val">0</span></div>
  <div class="bar-container"><div id="user-bar" class="bar"></div></div>
  <div class="row">
    <button class="action" onclick="useWater()">Water</button>
    <button class="action" onclick="useBeer()">Beer</button>
    <button class="action" onclick="useIceCream()">Ice Cream</button>
  </div>
</div>

</body>
</html>
